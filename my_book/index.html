<!DOCTYPE html>
<html lang="zh-Hant">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>æ ¡åœ’äºŒæ‰‹æ›¸äº¤æ˜“å¹³å°-é¦–é </title>
    <link rel="stylesheet" href="styles.css" />
</head>

<body>
    <header>
        <div class="logo-title">
            <h1>ğŸ“š æ ¡åœ’äºŒæ‰‹æ›¸äº¤æ˜“å¹³å°</h1>
        </div>
        <nav>
            <a href="index.html">é¦–é </a>
            <a href="profile.html">å€‹äººè³‡æ–™</a>
            <a href="upload.php">ä¸Šå‚³æ›¸ç±</a>
            <a href="seller.php">æˆ‘çš„å•†å“ç®¡ç†</a>
            <a href="communicate.php">æºé€š</a>
            <a href="TransactionRecords.php">äº¤æ˜“ç´€éŒ„</a>
            <a href="evaluate.html">è©•åƒ¹</a>
            <div class="user-status">
                <span id="accountNameDisplay" style="display: none;"></span>
                <a href="profile.html" id="profileLink" class="user-link" style="display: none;">å€‹äººè³‡æ–™</a>
                <a href="login.html" id="loginLink" class="user-link">ç™»å…¥</a>
            </div>
        </nav>
    </header>

    <section class="hero">
        <h2>æ­¡è¿ä¾†åˆ°æœ€æ£’çš„äºŒæ‰‹æ›¸å¹³å°ï¼</h2>
        <p>çœéŒ¢ã€ç’°ä¿åˆä¾¿åˆ©ï¼Œå¿«ä¾†æ‰¾æ‰¾ä½ çš„ä¸‹ä¸€æœ¬æ›¸å§ï¼</p>
        <input type="text" id="searchInput" placeholder="è¼¸å…¥æ›¸åã€ä½œè€…" />
        <button onclick="searchBooks()">ğŸ” æœå°‹</button>
    </section>

    <section class="book-list" id="bookList">
    </section>

    <footer>
        <p>&copy; 2025 æ ¡åœ’äºŒæ‰‹æ›¸äº¤æ˜“å¹³å°</p>
    </footer>

    <script>
        // å¾ localStorage è®€å–æ›¸ç±é™£åˆ—
        function loadBooks() {
            const booksJSON = localStorage.getItem("books");
            if (!booksJSON) return [];
            try {
                return JSON.parse(booksJSON);
            } catch {
                return [];
            }
        }

        // å­˜å› localStorage
        function saveBooks(books) {
            localStorage.setItem("books", JSON.stringify(books));
        }

        // ä¸‹æ¶æ›¸ç±åŠŸèƒ½ï¼Œæ ¹æ“š ISBN ç§»é™¤
        function removeBook(isbn) {
            let books = loadBooks();
            books = books.filter(book => book.isbn !== isbn);
            saveBooks(books);
            renderBooks(); // é‡æ–°æ¸²æŸ“å…¨éƒ¨æ›¸ç±
        }

        // æ¸²æŸ“æ›¸ç±å¡ç‰‡ï¼ˆå¯å‚³å…¥ç‰¹å®šæ›¸ç±æ¸…å–®ï¼‰
        function renderBooks(bookList) {
            const books = bookList || loadBooks();
            const container = document.getElementById("bookList");
            container.innerHTML = "";

            if (books.length === 0) {
                container.innerHTML = "<p>æ²’æœ‰æ‰¾åˆ°ç¬¦åˆæ¢ä»¶çš„æ›¸ç±ã€‚</p>";
                return;
            }

            books.forEach((book) => {
                const card = document.createElement("div");
                card.className = "book-card";

                const imgSrc = book.imageDataUrl || "https://via.placeholder.com/150x200?text=ç„¡åœ–ç‰‡";

                card.innerHTML = `
                    <img src="${imgSrc}" alt="æ›¸ç±å°é¢" />
                    <h3>${book.title}</h3>
                    <p>ä½œè€…: ${book.author}</p>
                    <p>ISBN: ${book.isbn}</p>
                    <p>åƒ¹æ ¼: NT$${book.price}</p>
                    <p>${book.description || ""}</p>
                    `;

                // å‚™è¨»ï¼šå¦‚æœæ‚¨åœ¨é¦–é ç¢ºå¯¦éœ€è¦ä¸‹æ¶åŠŸèƒ½ï¼Œè«‹å–æ¶ˆè¨»é‡‹ä¸‹æ–¹äº‹ä»¶ç›£è½å™¨å’ŒæŒ‰éˆ•
                // card.querySelector(".remove-btn").addEventListener("click", () => {
                //     if (confirm(`ç¢ºå®šè¦ä¸‹æ¶ã€Š${book.title}ã€‹å—ï¼Ÿ`)) {
                //         removeBook(book.isbn);
                //     }
                // });

                container.appendChild(card);
            });
        }

        // æœå°‹æ›¸ç±
        function searchBooks() {
            const keyword = document.getElementById("searchInput").value.trim().toLowerCase();
            const books = loadBooks();

            const filteredBooks = books.filter(book =>
                book.title.toLowerCase().includes(keyword) ||
                book.author.toLowerCase().includes(keyword) ||
                book.isbn.toLowerCase().includes(keyword) ||
                (book.description && book.description.toLowerCase().includes(keyword)) // å…è¨±æœå°‹æè¿°
            );

            renderBooks(filteredBooks);
        }

        // åˆå§‹åŒ–é é¢æ¸²æŸ“å’Œè™•ç†ç™»å…¥ç‹€æ…‹
        document.addEventListener("DOMContentLoaded", function() {
            renderBooks(); // æ¸²æŸ“æ‰€æœ‰æ›¸ç±

            const accountNameDisplay = document.getElementById("accountNameDisplay");
            const profileLink = document.getElementById("profileLink");
            const loginLink = document.getElementById("loginLink");

            // å¾ localStorage ç²å–ç•¶å‰ç™»å…¥çš„ä½¿ç”¨è€…è³‡è¨Š
            // å‡è¨­ currentUser çµæ§‹ç‚º { account: "ç”¨æˆ¶å", role: "buyer/seller" }
            const currentUser = JSON.parse(localStorage.getItem("currentUser"));

            if (currentUser && currentUser.account) {
                // å¦‚æœæœ‰ç”¨æˆ¶ç™»å…¥ï¼Œé¡¯ç¤ºå¸³è™Ÿåç¨±å’Œå€‹äººè³‡æ–™é€£çµ
                accountNameDisplay.textContent = `æ­¡è¿ï¼Œ${currentUser.account}`;
                accountNameDisplay.style.display = "inline"; // é¡¯ç¤ºå¸³è™Ÿåç¨±
                profileLink.style.display = "inline-block"; // é¡¯ç¤ºå€‹äººè³‡æ–™é€£çµ
                loginLink.style.display = "none"; // éš±è—ç™»å…¥é€£çµ
            } else {
                // å¦‚æœæ²’æœ‰ç”¨æˆ¶ç™»å…¥ï¼Œé¡¯ç¤ºç™»å…¥é€£çµ
                accountNameDisplay.style.display = "none"; // éš±è—å¸³è™Ÿåç¨±
                profileLink.style.display = "none"; // éš±è—å€‹äººè³‡æ–™é€£çµ
                loginLink.style.display = "inline-block"; // é¡¯ç¤ºç™»å…¥é€£çµ
            }
        });
    </script>
</body>

</html>