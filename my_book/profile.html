<!DOCTYPE html>
<html lang="zh-Hant">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å€‹äººåŸºæœ¬è³‡æ–™</title>
    <style>
        /* é€šç”¨æ¨£å¼è¨­å®š */

        * {
            box-sizing: border-box;
            font-family: "Helvetica Neue", "Noto Sans TC", sans-serif;
        }

        body {
            margin: 0;
            background: #f7f8fa;
            color: #333;
        }
        /* é é¦–æ¨£å¼ */

        header {
            background: #3f51b5;
            color: white;
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
        }

        .logo {
            font-size: 1.5rem;
            font-weight: bold;
        }

        nav a {
            color: white;
            margin: 0 10px;
            text-decoration: none;
        }
        /* ä¸»å…§å®¹å®¹å™¨æ¨£å¼ (å´é‚Šæ¬„ + ä¸»è¡¨å–®) */

        .main-container {
            display: flex;
            padding: 20px;
        }
        /* å´é‚Šæ¬„æ¨£å¼ */

        aside.sidebar {
            width: 200px;
            background: #e0e0e0;
            padding: 20px;
            border-radius: 8px;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }

        aside.sidebar ul {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        aside.sidebar li {
            margin: 10px 0;
        }

        aside.sidebar a {
            text-decoration: none;
            color: #333;
        }
        /* ç™»å‡ºæŒ‰éˆ•æ¨£å¼ */

        .logout-btn {
            display: block;
            width: 100%;
            padding: 10px;
            background-color: #dc3545;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            text-align: center;
            margin-top: 20px;
            font-size: 1em;
            transition: background-color 0.3s ease;
        }

        .logout-btn:hover {
            background-color: #c82333;
        }
        /* å€‹äººè³‡æ–™è¡¨å–®å€åŸŸæ¨£å¼ */

        .profile-form {
            flex: 1;
            background: white;
            padding: 30px;
            margin-left: 20px;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.05);
        }
        /* è¡¨å–®ç¶²æ ¼ä½ˆå±€ */

        .form-grid {
            display: grid;
            grid-template-columns: 150px 1fr;
            gap: 10px 20px;
            margin-bottom: 20px;
        }

        label {
            font-weight: bold;
        }
        /* è¼¸å…¥æ¡†å’Œæ–‡å­—å€åŸŸæ¨£å¼ */

        input[type="text"],
        input[type="email"],
        textarea {
            width: 100%;
            padding: 8px;
            border: 1px solid #ccc;
            border-radius: 4px;
        }
        /* åªè®€è¼¸å…¥æ¡†çš„æ¨£å¼ */

        input[readonly] {
            background-color: #e9ecef;
            /* æ·ºç°è‰²èƒŒæ™¯è¡¨ç¤ºä¸å¯ç·¨è¼¯ */
            cursor: not-allowed;
            /* é¼ æ¨™é¡¯ç¤ºç¦æ­¢ç¬¦è™Ÿ */
        }

        textarea {
            resize: vertical;
            height: 100px;
        }
        /* ä½”æ»¿ä¸€è¡Œæ¨£å¼ */

        .form-full {
            margin-bottom: 20px;
        }
        /* æŒ‰éˆ•å€å¡Šæ¨£å¼ */

        .form-button {
            text-align: center;
        }

        button {
            background-color: #3f51b5;
            color: white;
            border: none;
            padding: 10px 25px;
            margin: 5px;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }

        button:hover {
            background-color: #303f9f;
        }
        /* éš±è—å…ƒç´ æ¨£å¼ */

        .hidden {
            display: none;
        }
        /* é å°¾æ¨£å¼ */

        footer {
            text-align: center;
            padding: 20px;
            background: #f0f0f0;
            margin-top: 40px;
        }
        /* éŸ¿æ‡‰å¼è¨­è¨ˆï¼šå°è¢å¹•ä½ˆå±€èª¿æ•´ */

        @media (max-width: 768px) {
            .main-container {
                flex-direction: column;
            }
            aside.sidebar {
                width: 100%;
                margin-bottom: 20px;
            }
            .profile-form {
                margin-left: 0;
            }
            .form-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>

<body>

    <header>
        <div class="logo">æˆ‘çš„å€‹äººè³‡æ–™</div>
        <nav>
            <a href="#">é—œæ–¼æˆ‘å€‘</a>
            <a href="#">è¯çµ¡</a>
        </nav>
        <div class="profile-icon">ğŸ‘¤</div>
    </header>

    <div class="main-container">
        <aside class="sidebar">
            <div>
                <ul>
                    <li><a href="index.html">é¦–é </a></li>
                    <li><a href="profile.html">å€‹äººè³‡æ–™</a></li>
                    <li><a href="upload.html">ä¸Šå‚³æ›¸ç±</a></li>
                    <li><a href="seller.html">æˆ‘çš„å•†å“ç®¡ç†</a></li>
                    <li><a href="communicate.html">æºé€š</a></li>
                    <li><a href="TransactionRecords.html">äº¤æ˜“ç´€éŒ„</a></li>
                    <li><a href="evaluate.html">è©•åƒ¹</a></li>
                </ul>
            </div>
            <button id="logoutBtn" class="logout-btn">ç™»å‡º</button>
        </aside>

        <div class="profile-form">
            <h2>å€‹äººåŸºæœ¬è³‡æ–™</h2>

            <form id="profileForm">
                <div class="form-grid">
                    <label for="name">å§“å:</label>
                    <span id="nameDisplay"></span>
                    <input type="text" id="nameInput" class="hidden">

                    <label for="email">é›»å­éƒµä»¶:</label>
                    <span id="emailDisplay"></span>
                    <input type="email" id="emailInput" class="hidden">

                    <label for="studentId">å­¸è™Ÿ:</label>
                    <span id="studentIdDisplay"></span>
                    <input type="text" id="studentIdInput" class="hidden">

                    <label for="account">å¸³è™Ÿ:</label>
                    <span id="accountDisplay"></span>
                    <input type="text" id="accountInput" class="hidden" readonly>

                    <label for="department">ç§‘ç³»:</label>
                    <span id="departmentDisplay"></span>
                    <input type="text" id="departmentInput" class="hidden">

                    <label for="password">å¯†ç¢¼:</label>
                    <span>********ï¼ˆä¿è­·éš±ç§ï¼‰
                        <a href="change-password.html">è®Šæ›´å¯†ç¢¼</a>
                    </span>

                    <label for="phone">é›»è©±:</label>
                    <span id="phoneDisplay"></span>
                    <input type="text" id="phoneInput" class="hidden">
                </div>

                <div class="form-full">
                    <label for="bio">å€‹äººç°¡ä»‹:</label>
                    <span id="bioDisplay"></span>
                    <textarea id="bioInput" class="hidden"></textarea>
                </div>

                <div class="form-button">
                    <button type="button" id="editBtn">ç·¨è¼¯</button>
                    <button type="submit" id="saveBtn" class="hidden">å„²å­˜è®Šæ›´</button>
                </div>
            </form>
        </div>
    </div>

    <footer>
        &copy; 2025 æ ¡åœ’äºŒæ‰‹æ›¸äº¤æ˜“å¹³å°.
    </footer>

    <script>
        // DOM å…ƒç´ ç²å–
        const editBtn = document.getElementById("editBtn");
        const saveBtn = document.getElementById("saveBtn");
        const form = document.getElementById("profileForm");
        const logoutBtn = document.getElementById("logoutBtn");

        // å®šç¾©éœ€è¦åˆ‡æ›é¡¯ç¤º/ç·¨è¼¯æ¨¡å¼çš„æ¬„ä½ ID å‰ç¶´
        // æ³¨æ„ï¼š'account' ä¸åœ¨ 'fields' é™£åˆ—ä¸­ï¼Œå› ç‚ºå®ƒåªè®€ä¸”ä¸åƒèˆ‡ç·¨è¼¯æ¨¡å¼çš„åˆ‡æ›
        const fields = ["name", "email", "studentId", "department", "phone", "bio"];

        // æª¢æŸ¥ä½¿ç”¨è€…ç™»å…¥ç‹€æ…‹ä¸¦è¼‰å…¥è³‡æ–™
        let currentUser = JSON.parse(localStorage.getItem("currentUser"));

        if (!currentUser) {
            alert("è«‹å…ˆç™»å…¥ï¼");
            window.location.href = "login.html"; // å‡è¨­æ‚¨çš„ç™»å…¥é é¢æ˜¯ login.html
        }

        /**
         * è¼‰å…¥ä¸¦é¡¯ç¤ºç•¶å‰ä½¿ç”¨è€…çš„å€‹äººè³‡æ–™ã€‚
         * å¾ localStorage è®€å– currentUser çš„è³‡æ–™ä¸¦å¡«å……åˆ°å°æ‡‰çš„ span å’Œ input å…ƒç´ ä¸­ã€‚
         */
        function loadProfileData() {
            if (currentUser) {
                document.getElementById("nameDisplay").textContent = currentUser.name || "æœªè¨­å®š";
                document.getElementById("nameInput").value = currentUser.name || "";

                document.getElementById("emailDisplay").textContent = currentUser.email || "æœªè¨­å®š";
                document.getElementById("emailInput").value = currentUser.email || "";

                document.getElementById("studentIdDisplay").textContent = currentUser.studentId || "æœªè¨­å®š";
                document.getElementById("studentIdInput").value = currentUser.studentId || "";

                document.getElementById("accountDisplay").textContent = currentUser.account || "æœªè¨­å®š";
                document.getElementById("accountInput").value = currentUser.account || ""; // å¸³è™Ÿå§‹çµ‚è¨­ç½®å€¼ï¼Œä½†è¨­ç‚ºåªè®€

                document.getElementById("departmentDisplay").textContent = currentUser.department || "æœªè¨­å®š";
                document.getElementById("departmentInput").value = currentUser.department || "";

                document.getElementById("phoneDisplay").textContent = currentUser.phone || "æœªè¨­å®š";
                document.getElementById("phoneInput").value = currentUser.phone || "";

                document.getElementById("bioDisplay").textContent = currentUser.bio || "æœªè¨­å®š";
                document.getElementById("bioInput").value = currentUser.bio || "";
            }
        }

        // é é¢å…§å®¹è¼‰å…¥å®Œæˆå¾ŒåŸ·è¡Œ
        document.addEventListener("DOMContentLoaded", loadProfileData);

        // ç·¨è¼¯æŒ‰éˆ•é»æ“Šäº‹ä»¶ç›£è½å™¨
        editBtn.addEventListener("click", () => {
            fields.forEach(field => {
                document.getElementById(`${field}Display`).classList.add("hidden");
                document.getElementById(`${field}Input`).classList.remove("hidden");
            });

            // å¸³è™Ÿ (account) çš„è¼¸å…¥æ¡†é›–ç„¶å­˜åœ¨ï¼Œä½†åœ¨ HTML ä¸­è¢«è¨­ç‚º readonlyï¼Œæ‰€ä»¥ç„¡éœ€åœ¨æ­¤ç‰¹åˆ¥è™•ç†å…¶ hidden classã€‚
            // ç¢ºä¿å¸³è™Ÿçš„ display ä»ç„¶éš±è—ï¼Œinput é¡¯ç¤ºï¼ˆé›–ç„¶åªè®€ï¼‰
            document.getElementById("accountDisplay").classList.add("hidden");
            document.getElementById("accountInput").classList.remove("hidden");


            editBtn.classList.add("hidden");
            saveBtn.classList.remove("hidden");
        });

        // è¡¨å–®æäº¤äº‹ä»¶ç›£è½å™¨ (ç•¶é»æ“Šå„²å­˜æŒ‰éˆ•æ™‚è§¸ç™¼)
        form.addEventListener("submit", (e) => {
            e.preventDefault();

            if (!currentUser) {
                alert("æœªç™»å…¥ï¼Œç„¡æ³•å„²å­˜è³‡æ–™ï¼");
                return;
            }

            // æ›´æ–° currentUser ç‰©ä»¶çš„å±¬æ€§
            currentUser.name = document.getElementById("nameInput").value.trim();
            currentUser.email = document.getElementById("emailInput").value.trim();
            currentUser.studentId = document.getElementById("studentIdInput").value.trim(); // å­¸è™Ÿç¾åœ¨æœƒè¢«æ›´æ–°
            // currentUser.account å¸³è™Ÿæ˜¯åªè®€çš„ï¼Œæ‰€ä»¥ä¸æœƒå¾è¼¸å…¥æ¡†ç²å–å€¼ä¾†æ›´æ–°
            currentUser.department = document.getElementById("departmentInput").value.trim();
            currentUser.phone = document.getElementById("phoneInput").value.trim();
            currentUser.bio = document.getElementById("bioInput").value.trim();

            // å°‡æ›´æ–°å¾Œçš„ currentUser ç‰©ä»¶å„²å­˜å› localStorage
            localStorage.setItem("currentUser", JSON.stringify(currentUser));

            // åŒæ­¥æ›´æ–° 'users' é™£åˆ—ä¸­çš„è³‡æ–™
            let allUsers = JSON.parse(localStorage.getItem("users") || "[]");
            const userIndex = allUsers.findIndex(user => user.account === currentUser.account);
            if (userIndex > -1) {
                allUsers[userIndex] = currentUser;
                localStorage.setItem("users", JSON.stringify(allUsers));
            }

            // éæ­·æ‰€æœ‰å¯ç·¨è¼¯æ¬„ä½ï¼Œå°‡è¼¸å…¥æ¡†å†æ¬¡éš±è—ï¼Œé¡¯ç¤º span å…ƒç´ 
            fields.forEach(field => {
                const input = document.getElementById(`${field}Input`);
                const display = document.getElementById(`${field}Display`);
                display.textContent = input.value;
                input.classList.add("hidden");
                display.classList.remove("hidden");
            });

            // å¸³è™Ÿ (account) è™•ç†ï¼šå°‡è¼¸å…¥æ¡†éš±è—ï¼Œé¡¯ç¤º span
            document.getElementById("accountInput").classList.add("hidden");
            document.getElementById("accountDisplay").classList.remove("hidden");


            saveBtn.classList.add("hidden");
            editBtn.classList.remove("hidden");

            alert("å€‹äººè³‡æ–™å·²æˆåŠŸå„²å­˜ï¼");
        });

        // ç™»å‡ºæŒ‰éˆ•é»æ“Šäº‹ä»¶ç›£è½å™¨
        logoutBtn.addEventListener("click", () => {
            if (confirm("ç¢ºå®šè¦ç™»å‡ºå—ï¼Ÿ")) {
                localStorage.removeItem("currentUser");
                // æ‚¨ä¹Ÿå¯ä»¥é¸æ“‡æ¸…é™¤å…¶ä»–ç›¸é—œçš„ localStorage è³‡æ–™ï¼Œä¾‹å¦‚ï¼š
                // localStorage.removeItem("chats");
                // localStorage.removeItem("transactions");
                // localStorage.removeItem("ratings");
                // localStorage.removeItem("books"); // å¦‚æœæ‚¨çš„ books ä¹Ÿæ˜¯é‡å°æ¯å€‹ç”¨æˆ¶ç§æœ‰çš„

                alert("æ‚¨å·²æˆåŠŸç™»å‡ºï¼");
                window.location.href = "login.html"; // å°å‘ç™»å…¥é é¢
            }
        });
    </script>
</body>

</html>